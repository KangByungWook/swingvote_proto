<!--<script>
//params[:id] 로 들어온 objectId를 이용해 posts 테이블에서 쿼리 진행
$(function() {
  var posts = Parse.Object.extend("posts");
  var one = new Parse.Query(posts);
  one.get("", {
    success: function(result) {
      var img = result.get("image_url");
      $('#post_img').css("background-image", "url('"+img+"')");
      $('#slide-left').html(result.get("left")["content"]);
      $('#post_title').html(result.get("subject"));
      $('#slide-right').html(result.get("right")["content"]);
      $('#link_url_length').val(result.get("links").length);
      for (i = 0; i < result.get("links").length; i++) {
        $('#link_url_'+i).val(result.get("links")[i]);
      }
    },
    error: function(error) {
      console.log(error);
    }
  });
});
</script>-->
<% @post.get.each do |i| %>
<div class="post-slider swiper-container">
  <div id="<%=@id%>_card" class="post_card swiper-wrapper">
    <div id="<%=@id%>_left"class="slide-left slide-center swiper-slide"><%=i["left"]["content"]%></div>
    <div id="<%=@id%>" class="slide-topic swiper-slide">
      <div id="post_img" class="post_img picture" style="width:100%;height:100%;background-image:url('<%=i["image_url"]%>');background-size:cover;background-repeat:no-repeat;background-position: center center;">
        <div class="blurry-box" style="background:url('http://cfs6.blog.daum.net/image/14/blog/2008/03/11/23/23/47d695f9411f3&filename=%EB%AC%B4%EB%8A%AC%EC%97%86%EB%8A%94%EA%B2%80%EC%A0%95%EC%83%89%EB%B0%B0%EA%B2%BD.jpg')"></div>
        <div class="text" style="text-align:center;width:100%">
          <span id="post_title" style="font-size:15px;color:white"><%=i["subject"]%></span>
        </div>
      </div>
    </div>
    <div id="<%=@id%>_right" class="slide-right slide-center swiper-slide"><%=i["right"]["content"]%></div>
  </div>
</div>

<script>
  $(function() {
      var width = (window.innerWidth > 0) ? window.innerWidth : screen.width;
      console.log(width);
      $('#<%=@id%>_card').css("transform", "translate3d(-"+width+"px, 0px, 0px)");
      $('#<%=@id%>_card').on('transitionend webkitTransitionEnd oTransitionEnd otransitionend MSTransitionEnd', 
        function() {
          var a = $('#<%=@id%>_card').css("transform");
          var arrA = matrixToArray(a);
          var x = (arrA[4] == 0) ? Number(arrA[4]) : -arrA[4];
          console.log(x);
          var content;
          var confirm_option;
          
          if (width > x) {
            confirm_option = {
              title: 'Swing Vote',
              buttons: { '확인': true, '취소': false },
              focus: 0,
              submit:function(e,v,m,f){ 
          		  if (v === true) {
          		    console.log("left - true");
                  /*location.href = '/main/post_content/reject'*/
          		  } else if (v === false) {
          		    console.log("left - false");
                  $('#<%=@id%>_card').css("transform", "translate3d(-"+width+"px, 0px, 0px)");
          		  }
        		  }
            };
            content = $("#<%=@id%>_left").html();
            $.prompt(content, confirm_option);
          } else if(width < x) {
            confirm_option = {
              title: 'Swing Vote',
              buttons: { '확인': true, '취소': false },
              focus: 0,
              submit:function(e,v,m,f){ 
          		  if (v === true) {
          		    console.log("right - true");
                  /*location.href = '/main/post_content/accept'*/
          		  } else if (v === false) {
          		    console.log("right - false");
                  $('#<%=@id%>_card').css("transform", "translate3d(-"+width+"px, 0px, 0px)");
          		  }
        		  }
            };
            content = $("#<%=@id%>_right").html();
            $.prompt(content, confirm_option);
          }
      });
  });
</script>
<% end %>

<script>
  function matrixToArray(str) {
    return str.match(/(-?[0-9\.]+)/g);
  }
</script>
<script>
  $(function() {
    var swiper = new Swiper('.post-slider', {
      direction: 'horizontal',
      speed: 300,
      resistance: true,
      resistanceRatio: 1
    });
  });
</script>

<h4 style="margin-left:1em;"><p>통계</p></h4>
<div class="ct-chart ct-perfect-fourth" style="width:100%;height:100px;margin: auto;"></div>

<script>
var chart = new Chartist.Pie('.ct-chart', {
  labels: ['표현의 자유이다!!', '그건 좀 아니지 않나??'],
  series: [60, 40]
}, {
  width: 200,
  height: 200,
  donut: true,
  donutWidth: 20,
  startAngle: 270,
  total: 200,
  showLabel: true,
  chartPadding: 30
},options_responsive);

var options_responsive = [
  ["screen and (max-width: 640px)", {
    showLine: false,
    showArea: true
  }]
]
chart.on('draw', function(data) {
  if(data.type === 'slice') {
    // Get the total path length in order to use for dash array animation
    var pathLength = data.element._node.getTotalLength();

    // Set a dasharray that matches the path length as prerequisite to animate dashoffset
    data.element.attr({
      'stroke-dasharray': pathLength + 'px ' + pathLength + 'px'
    });

    // Create animation definition while also assigning an ID to the animation for later sync usage
    var animationDefinition = {
      'stroke-dashoffset': {
        id: 'anim' + data.index,
        dur: 1000,
        from: -pathLength + 'px',
        to:  '0px',
        easing: Chartist.Svg.Easing.easeOutQuint,
        // We need to use `fill: 'freeze'` otherwise our animation will fall back to initial (not visible)
        fill: 'freeze'
      }
    };

    // If this was not the first slice, we need to time the animation so that it uses the end sync event of the previous animation
    if(data.index !== 0) {
      animationDefinition['stroke-dashoffset'].begin = 'anim' + (data.index - 1) + '.end';
    }

    // We need to set an initial value before the animation starts as we are not in guided mode which would do that for us
    data.element.attr({
      'stroke-dashoffset': -pathLength + 'px'
    });

    // We can't use guided mode as the animations need to rely on setting begin manually
    // See http://gionkunz.github.io/chartist-js/api-documentation.html#chartistsvg-function-animate
    data.element.animate(animationDefinition, false);
  }
});

// For the sake of the example we update the chart every time it's created with a delay of 8 seconds
// chart.on('created', function() {
//   if(window.__anim21278907124) {
//     clearTimeout(window.__anim21278907124);
//     window.__anim21278907124 = null;
//   }
//   window.__anim21278907124 = setTimeout(chart.update.bind(chart), 10000);
// });

</script>

<% @post.get.each do |i| %>
<h4 style="margin-left:1em;">관련 기사</h4>
<div class="link-slider swiper-container">
  <div class="swiper-wrapper">
    <input id="link_url_length" type="hidden">
    <% for j in (0...i["links"].length) %>
    <%link_url_img = LinkThumbnailer.generate(i["links"][j]).images.first.src.to_s%>
      <div class="swiper-slide" style="background-image:url('<%=link_url_img%>');width:100%;height:100%;background-size:cover;background-repeat:no-repeat;background-position: center center;">
        <a href="/main/readability/<%=i["objectId"]%>_<%=j%>" style="text-decoration:none;">
        <span style="font-size:1em; position:absolute; bottom:0; left:0;">
          <%=LinkThumbnailer.generate(i["links"][j]).title%>
        </span>
        </a>
      </div>
    <% end %>
  </div>
</div>
<% end %>

<br>
<script>
  $(function() {
    var swiper = new Swiper('.link-slider', {
      slidesPerView: 2,
      spaceBetween: 10,
      resistance: true,
      resistanceRatio: 1,
    });
  });
</script>


<!-- 댓글 쪽 데이터도 아직은 보류 -->

<!--기존 댓글 체계-->
<link href='http://fonts.googleapis.com/css?family=Noto+Sans' rel='stylesheet' type='text/css'>

<div class="panel-header">
  <span id="panel-title"> Comments </span>
  <span class="counter"> 3 </span>
</div>
<form action="/main/do_reply" method="POST">
    <p class="formtitle"> 댓글 달기 </p>
    <input type="hidden" value="<%=@id%>" name="post_id">
    <input type="hidden" value="true" name="pros_and_cons">
    <input id="author" type="text" placeholder="현재 사용자" value = "사용자 고유id" name="user_id">
    <textarea placeholder="Comment" name="content"></textarea>
    <input class="commentButton" type='submit' value='댓글 등록' style="text-align:right"/>  
</form>
<div class="panel-collapse">
<%for i in (0...@repliesDisplay.length)%>
  <!--왼쪽부분-->
  <%if !@repliesLeft[i].nil?%>
  <div class="comment_left">
    <div class="orientation">
        <img class="icon" src="http://i.imgur.com/JIt0euT.png"/>
        <span> <%=@repliesLeft[i]["user_id"]%> </span>
        <small> <%=@repliesLeft[i]["createdAt"].in_time_zone("Seoul").strftime("%Y/%m/%d %I:%M%p")%> </small>
    </div>
    <div class="comment-text">
     <%=@repliesLeft[i]["content"]%>
    </div>
  </div>
  <%end%>
  <!--오른쪽부분-->
  <%if !@repliesRight[i].nil? %>
  <div class="comment_right">
    <div class="orientation">
        <img class="icon" src="http://i.imgur.com/JIt0euT.png"/>
        <span> <%=@repliesRight[i]["user_id"]%> </span>
        <small> <%=@repliesRight[i]["createdAt"].in_time_zone("Seoul").strftime("%Y/%m/%d %I:%M%p")%> </small>
    </div>
    <div class="comment-text">
     <%=@repliesRight[i]["content"]%>
    </div>
  </div>
  <%end%>
<%end%>
</div>


<!--<div class="floating-button">-->
<!--<style>-->
<!--  .floating-button {-->
<!--    width: 40px;-->
<!--    height: 40px;-->
<!--    position: fixed;-->
<!--    right: 0.5em;-->
<!--    bottom: 0.5em;-->
<!--    background: black;-->
<!--    opacity: 0.8;-->
<!--    pointer: cursor;-->
<!--  }-->
<!--</style>-->
<!--</div>-->

<!--<div class="hidden-drawer">-->
<!--<style>-->
<!--  .hidden-drawer {-->
<!--    width: 78%;-->
<!--    height: 40px;-->
<!--    position: fixed;-->
<!--    left: 0.5em;-->
<!--    bottom: 0.5em;-->
<!--    background: yellow;-->
<!--    opacity: 0.7;-->
<!--    display: none;-->
<!--  }-->
<!--</style>-->
<!--</div>-->

<!--<script>-->
<!--  $(function() {-->
<!--    $('.floating-button').click(function() {-->
<!--      $('.hidden-drawer').toggle('slide', 300);-->
<!--    });-->
<!--  });-->
<!--</script>-->-->