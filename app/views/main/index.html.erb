<!-- main slider -->
<script>
//핫이슈, 메인슬라이더 쿼리
  $(function() {
    var posts = Parse.Object.extend("posts");
    var main = new Parse.Query(posts);
    main.containedIn("tags", ["핫이슈"]);
    main.limit(5);
    main.find({
      success: function(results) {
        for (var i = 0; i < results.length; i++) {
          $('#hot_id_'+i).val(results[i].id);
          var hot_img = results[i].get("image_url");
          $('#hot_pic'+i).css("background-image", "url('"+hot_img+"')");
          $('#hot_maintag_'+i).html('#'+results[i].get("main_tag"));
          $('#hot_subject'+i).html(results[i].get("subject"));
          var hot_subtag = results[i].get("tags");
          for (var j = 0; j < hot_subtag.length; j++) {
            $('#hot_subtag_'+i+'_'+j).html('#'+hot_subtag[j]);
          }
        }
      },
      error: function(error) {
        console.log(error);
      }
    });
  });
</script>

<div class="main_slider swiper-container">
  <div class="swiper-wrapper">
  
  <% for i in (0...5) %>
    <div id="hot_<%=i%>" class="swiper-slide">
      <div class="slide-center swiper-slide" style="width: 100%; height: 100%;">
        <div id="hot_pic<%=i%>" class="main-background picture" style="">
          <table class="tag_box">
            <tr>
              <td class="tag">
                <div id="hot_maintag_<%=i%>" class="slide-center">#hot_maintag</div>
              </td>
              <% for j in (0...2) %>
              <td class="tag">
                <div id="hot_subtag_<%=i%>_<%=j%>" class="slide-center">#hot_subtag</div>
              </td>
              <% end %>
            <tr>
          </table>
          <div class="blurry-box" style="background:url('http://cfs6.blog.daum.net/image/14/blog/2008/03/11/23/23/47d695f9411f3&filename=%EB%AC%B4%EB%8A%AC%EC%97%86%EB%8A%94%EA%B2%80%EC%A0%95%EC%83%89%EB%B0%B0%EA%B2%BD.jpg')"></div>
          <div class="text">
            <span id="hot_subject<%=i%>" style="font-size:20px;color:white"></span>
            <input id="hot_id_<%=i%>" type="hidden">
            <script>
              $(function() {
                $('#hot_<%=i%>').click(function() {
                  location.href = '/main/post_content/'+$('#hot_id_<%=i%>').val();
                });
              });
            </script>
          </div>
        </div>
      </div>
    </div>
  <% end %>
  
  </div>
</div>
<!-- main slider swiper -->
  <script>
    $(function() {
      var swiper = new Swiper('.main_slider', {
        speed: 700,
        /*direction: 'horizontal',*/
        loop: true,
        paginationClickable: true,
        grabCursor: true,
        autoplay: 3000,
        autoplayDisableOnInteraction: false,
        /*effect: 'cube',
        cube: {
          shadow: false,
          slideShadows: true,
          shadowOffset: 20,
          shadowScale: 0.94
        }*/
      });
    });
  </script>
  <!-- main slider end -->
  
  <!-- recent slider -->
  <br>
  <script>
  //시간순 슬라이더 쿼리
    $(function() {
      var posts = Parse.Object.extend("posts");
      var recent = new Parse.Query(posts);
      recent.descending("createdAt");
      recent.exists("subject");
      recent.limit(10);
      recent.find({
        success: function(results) {
          for (i = 0; i < results.length; i++) {
            $('#recent_id_'+i).val(results[i].id);
            $('#recent_subject'+i).html(results[i].get("subject"));
            $('#recent_maintag'+i).html('#'+results[i].get("main_tag"));
          }
        },
        error: function(error) {
          console.log(error);
        }
      });
    });
  </script>

  <div class="recent-slider swiper-container" style="border:3px solid #d91818;">
    <div id="recent" class="swiper-wrapper">
    <% for i in (0...10) %>
      <div id="recent_<%=i%>" class="slide-center swiper-slide">
        <span id="recent_maintag<%=i%>" style="font-size:15px; font-weight:bold;">#</span>
        &nbsp;&nbsp;&nbsp;
        <span id="recent_subject<%=i%>" style="font-size:15px;">subject</span>
        <input id="recent_id_<%=i%>" type="hidden">
        <script>
          $(function() {
            $('#recent_<%=i%>').click(function() {
              location.href = '/main/post_content/'+$('#recent_id_<%=i%>').val();
            });
          });
        </script>
      </div>
    <% end %>
    </div>
  </div>  

<!-- recent slider script -->
<script>
  $(function() {
    var swiper = new Swiper('.recent-slider', {
      direction: 'horizontal',
      loop: true,
      autoplay: 2500,
      autoplayDisableOnInteraction: false
    });
  });
</script>
<!-- recent slider end -->


<script>
//선호 태그 쿼리
  $(function() {
    //이 쿼리에 앞서서 유저 테이블에서 쿼리를 통해 선호 태그들을 받아와서
    //배열에 저장한 후 반복문을 통해 각 배열 요소들을 기준으로 
    //post쿼리를 돌려서 아래의 값을 뽑아내야한다.
    var posts = Parse.Object.extend("posts");
    var preferTag = new Parse.Query(posts);
    preferTag.equalTo("main_tag","연예");
    preferTag.descending("createdAt");
    preferTag.limit(10);
    preferTag.find({
      success: function(results) {
        //핫이슈 슬라이더 쿼리와 동일하게 진행
        for (i = 0; i < results.length; i++) {
          $('#tag_maintag').html(results[i].get("main_tag"));
          var img = results[i].get("image_url");
          $('#tag_cardimg_'+i).css("background-image", "url('"+img+"')");
          $('#tag_cardsub_'+i).html(results[i].get("subject"));
          $('#tag_cardtag_'+i+'_main').html(results[i].get("main_tag"));
          for (j = 0; j < results[i].get("tags").length; j++) {
            $('#tag_cardtag_'+i+'_'+j).html(results[i].get("tags")[j]);
          }
          $('#tag_card_id_'+i).val(results[i].id);
        }
      },
      error: function(error) {
        console.log(error);
      }
    });
  });
</script>

<!-- tag slider -->
  <div style="width:100%; height:15px;"></div>
  <div class="tag-slider swiper-container">
    <p style="margin:0px; font-size:1.1em;">
      <span style="margin-left:10px; font-size:1.3em; font-weight:bold; pointer:cursor; margin-right:-0.5em;">#</span>
      <span id="tag_maintag" style="margin-left:10px; font-size:1.3em; font-weight:bold; pointer:cursor;"></span>
      <a style="float:right; margin-right:10px;">
        <span id="tag_more">더보기</span>
        <span class="glyphicon glyphicon-chevron-right"></span>
      </a>
    </p>
    <script>
      $(function() {
        $('#tag_maintag').click(function() {
          location.href = '/main/post_list/'+$(this).html();
        });
        $('#tag_more').click(function() {
          location.href = '/main/post_list/'+$('#tag_maintag').html();
        });
      });
    </script>
    
    <div style="width:100%; height:1em;"></div>
    <div class="swiper-wrapper">
      <% for i in (0..10) %>
        <div class="slide-topic swiper-slide">
          <div id="tag_cardimg_<%=i%>" class="post_img" style="background-image:url();background-size:cover;background-repeat:no-repeat;background-position: center center;">
          <input id="tag_card_id_<%=i%>" type="hidden">
          </div>
          <div class="slide-center post_title">
            <span id="tag_cardsub_<%=i%>" style="font-size:15px"></span>
          </div>
          <script>
            $(function() {
              $('#tag_cardimg_<%=i%>').click(function() {
                location.href = '/main/post_content/'+$('#tag_card_id_<%=i%>').val();
              });
              $('#tag_cardsub_<%=i%>').click(function() {
                location.href = '/main/post_content/'+$('#tag_card_id_<%=i%>').val();
              });
            });
          </script>
          <div class="slide-center post_tag">
            <div class="tag slide-center">
              <span>#</span>
              <span id="tag_cardtag_<%=i%>_main"></span>
            </div>
            <script>
              $(function() {
                $('#tag_cardtag_<%=i%>_main').click(function() {
                  location.href = '/main/post_list/'+$(this).html();
                });
              });
            </script>
            <% for j in (0...2) %>
              <div class="tag slide-center">
                <span>#</span>
                <span id="tag_cardtag_<%=i%>_<%=j%>"></span>
              </div>
              <script>
                $(function() {
                  $('#tag_cardtag_<%=i%>_<%=j%>').click(function() {
                    location.href = '/main/post_list/'+$(this).html();
                  });
                });
              </script>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  </div>
  
  <!--<div style="width:100%; height:50px;"></div>
  <div class="tag-slider swiper-container">
    <p style="margin:0px; font-size:1.1em;">
      <span style="margin-left:10px; font-size:1.3em;"><strong>#<%= @sisa_tag_name %></strong></span>
      <a style="float:right; margin-right:10px;" href="/main/post_list">더보기&nbsp;<span class="glyphicon glyphicon-chevron-right"></span></a>
    </p>
    <div style="width:100%; height:1em;"></div>
    <div class="swiper-wrapper">
      <% for x in (0...@sisa_sub.length) %>
        <div class="slide-topic swiper-slide">
          <div class="post_img" style="background-image:url('<%=@sisa_pic[x]%>');background-size:cover;background-repeat:no-repeat;background-position: center center;">
          </div>
          <div style="width:100%; height:0.3em;"></div>
          <div class="slide-center post_title"><span style="font-size:15px"><%=@sisa_sub[x] %></span></div>
          <div class="slide-center post_tag">
            <% for i in (0...@sisa_tag[x].length) %>
              <div class="tag slide-center">#<%= @sisa_tag[x][i] %></div>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  </div>-->
  
  
<div style="width:100%; height:30px;"></div>
<!-- tag slider swiper script -->
<script>
  $(function() {
    var swiper = new Swiper('.tag-slider', {
      speed: 500,
      slidesPerView: 1.3,
      loop: true,
      centeredSlides: true,
      resistance: true,
      resistanceRatio: 1,
      effect: 'coverflow',
      coverflow: {
        rotate: 40,
        stretch: 0,
        depth: 100,
        modifier: 1,
        slideShadows : true
      }
    });
  });
</script>
<!-- tag slider end -->

