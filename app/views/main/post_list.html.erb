<script>
  $(function() {
    var swiper = new Swiper('.post-slider', {
      direction: 'horizontal',
      speed: 300,
      resistance: true,
      resistanceRatio: 1
    });
  });
</script>

<script>
  function matrixToArray(str) {
    return str.match(/(-?[0-9\.]+)/g);
  }
</script>



<% for x in (0..2) %>
  <div class="post-slider swiper-container">
    <div id="post_card<%= x %>" class="post_card swiper-wrapper">
      <div id="slide-reject<%= x %>"class="slide-reject slide-center swiper-slide"><%=@list_choice[x][0]%></div>
      <div id="slide-topic<%= x %>" class="slide-topic swiper-slide">
        <a href="/main/post_content">
          <div class="post_img picture" style="width:100%;height:100%;background-image:url('<%=@list_pic[x]%>');background-size:cover;background-repeat:no-repeat;background-position: center center;">
            <div class="blurry-box" style="background:url('data:image/jpeg;base64,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')"></div>
            <div class="text" style="color:black"><%=@list_subject[x]%></div>
          </div>
        </a>
        <div class="post_title slide-center">topic</div>
        <div class="post_tag"></div>
      </div>
      <div id="slide-accept<%= x %>" class="slide-accept slide-center swiper-slide"><%=@list_choice[x][1]%></div>
    </div>
  </div>

  <script>
    $(function() {
      var width = (window.innerWidth > 0) ? window.innerWidth : screen.width;
      console.log(width);
      $('#post_card<%= x %>').css("transform", "translate3d(-"+width+"px, 0px, 0px)");
      $('#post_card<%= x %>').on('transitionend webkitTransitionEnd oTransitionEnd otransitionend MSTransitionEnd', 
        function() {
          var a = $('#post_card<%= x %>').css("transform");
          var arrA = matrixToArray(a);
          var x = (arrA[4] == 0) ? Number(arrA[4]) : -arrA[4];
          console.log(x);
          var content;
          var confirm_option;
          
          if (width > x) {
            confirm_option = {
              title: 'Swing Vote',
              buttons: { '확인': true, '취소': false },
              focus: 0,
              submit:function(e,v,m,f){ 
          		  if (v === true) {
          		    console.log("reject - true");
                  location.href = '/main/post_content/reject<%= x %>'
          		  } else if (v === false) {
          		    console.log("reject - false");
                  $('#post_card<%= x %>').css("transform", "translate3d(-"+width+"px, 0px, 0px)");
          		  }
        		  }
            };
            content = $("#slide-reject<%= x %>").html();
            $.prompt(content, confirm_option);
          } else if(width < x) {
            confirm_option = {
              title: 'Swing Vote',
              buttons: { '확인': true, '취소': false },
              focus: 0,
              submit:function(e,v,m,f){ 
          		  if (v === true) {
          		    console.log("accept -  true");
                  location.href = '/main/post_content/accept<%= x %>'
          		  } else if (v === false) {
          		    console.log("accept -  false");
                  $('#post_card<%= x %>').css("transform", "translate3d(-"+width+"px, 0px, 0px)");
          		  }
        		  }
            };
            content = $("#slide-accept<%= x %>").html();
            $.prompt(content, confirm_option);
          }
      });
    });
  </script>
<% end %>
